<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Attendance Tracker</title>
  <style>
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }

    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: left;
    }

    th {
      background-color: #f2f2f2;
    }

    .in {
      color: green;
    }

    .out {
      color: red;
    }
  </style>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      var db = openDatabase('attendance', '1.0', 'Attendance Database', 2 * 1024 * 1024);

      db.transaction(function (tx) {
        tx.executeSql('CREATE TABLE IF NOT EXISTS log (id INTEGER PRIMARY KEY, type TEXT, timestamp DATETIME)');
      });

      var inBtn = document.getElementById('inBtn');
      var outBtn = document.getElementById('outBtn');
      var resultDiv = document.getElementById('result');
      var historyTable = document.getElementById('historyTable');

      // Check the last recorded event on page load
      db.transaction(function (tx) {
        tx.executeSql('SELECT * FROM log ORDER BY timestamp DESC LIMIT 1', [], function (tx, result) {
          var lastEvent = result.rows.item(0);

          if (lastEvent && lastEvent.type === 'in') {
            inBtn.disabled = true;
            outBtn.disabled = false;
          } else {
            inBtn.disabled = false;
            outBtn.disabled = true;
          }
        });
      });

      // Load history from the database on page load
      db.transaction(function (tx) {
        tx.executeSql('SELECT * FROM log ORDER BY timestamp DESC', [], function (tx, result) {
          var rows = result.rows;

          for (var i = 0; i < rows.length; i++) {
            var row = rows.item(i);
            addToHistoryTable(row.type, new Date(row.timestamp));
          }
        });
      });

      inBtn.addEventListener('click', function () {
        logEvent('in');
        inBtn.disabled = true;
        outBtn.disabled = false;
      });

      outBtn.addEventListener('click', function () {
        logEvent('out');
        outBtn.disabled = true;
        inBtn.disabled = false;
      });

      document.getElementById('calculateBtn').addEventListener('click', calculateTotalHours);

      // Event listener for the "Reset" button
      document.getElementById('resetBtn').addEventListener('click', function () {
        db.transaction(function (tx) {
          tx.executeSql('DELETE FROM log');
        });
        inBtn.disabled = false;
        outBtn.disabled = true;
        resultDiv.textContent = '';
        clearHistoryTable();
      });

      function logEvent(type) {
        db.transaction(function (tx) {
          var timestamp = new Date().toISOString();
          tx.executeSql('INSERT INTO log (type, timestamp) VALUES (?, ?)', [type, timestamp]);

          // Add the event to the history table
          addToHistoryTable(type, new Date(timestamp));
        });
      }

      function addToHistoryTable(type, timestamp) {
        var row = historyTable.insertRow(1); // Insert at the beginning
        var cellType = row.insertCell(0);
        var cellTime = row.insertCell(1);

        cellType.textContent = type.toUpperCase();
        cellType.className = type; // Set class for styling
        cellTime.textContent = formatAMPM(timestamp);

        // Clear the result div when a new entry is added
        resultDiv.textContent = '';
      }

      function clearHistoryTable() {
        // Remove all rows except the header
        while (historyTable.rows.length > 1) {
          historyTable.deleteRow(1);
        }
      }

      function formatAMPM(date) {
        var hours = date.getHours();
        var minutes = date.getMinutes();
        var ampm = hours >= 12 ? 'PM' : 'AM';
        hours = hours % 12;
        hours = hours ? hours : 12; // the hour '0' should be '12'
        minutes = minutes < 10 ? '0' + minutes : minutes;
        var strTime = hours + ':' + minutes + ' ' + ampm;
        return strTime;
      }

      function calculateTotalHours() {
        db.transaction(function (tx) {
          tx.executeSql('SELECT * FROM log ORDER BY timestamp', [], function (tx, result) {
            var rows = result.rows;
            var totalHours = 0;

            for (var i = 0; i < rows.length; i += 2) {
              if (i + 1 < rows.length && rows.item(i).type === 'in' && rows.item(i + 1).type === 'out') {
                var inTime = new Date(rows.item(i).timestamp);
                var outTime = new Date(rows.item(i + 1).timestamp);

                var minutesDiff = (outTime - inTime) / (1000 * 60); // Convert milliseconds to minutes
                var hoursDiff = minutesDiff / 60; // Convert minutes to hours
                totalHours += hoursDiff;

                console.log('In: ' + inTime + ', Out: ' + outTime + ', Hours: ' + hoursDiff);
              }
            }

            resultDiv.textContent = 'Total Hours: ' + totalHours.toFixed(2);
          });
        });
      }
    });
  </script>
</head>
<body>
  <!-- Rest of your HTML content -->
</body>
</html>
