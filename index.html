<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Attendance Tracker</title>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      var db = openDatabase('attendance', '1.0', 'Attendance Database', 2 * 1024 * 1024);

      db.transaction(function (tx) {
        tx.executeSql('CREATE TABLE IF NOT EXISTS log (id INTEGER PRIMARY KEY, type TEXT, timestamp DATETIME)');
      });

      var inBtn = document.getElementById('inBtn');
      var outBtn = document.getElementById('outBtn');
      var resultDiv = document.getElementById('result');

      db.transaction(function (tx) {
        tx.executeSql('SELECT * FROM log ORDER BY timestamp DESC LIMIT 1', [], function (tx, result) {
          var lastEvent = result.rows.item(0);

          if (lastEvent && lastEvent.type === 'in') {
            inBtn.disabled = true;
            outBtn.disabled = false;
          } else {
            inBtn.disabled = false;
            outBtn.disabled = true;
          }
        });
      });

      inBtn.addEventListener('click', function () {
        logEvent('in');
        inBtn.disabled = true;
        outBtn.disabled = false;
      });

      outBtn.addEventListener('click', function () {
        logEvent('out');
        outBtn.disabled = true;
        inBtn.disabled = false;
      });

      document.getElementById('calculateBtn').addEventListener('click', calculateTotalHours);

      // Event listener for the "Reset" button
      document.getElementById('resetBtn').addEventListener('click', function () {
        db.transaction(function (tx) {
          tx.executeSql('DELETE FROM log');
        });
        inBtn.disabled = false;
        outBtn.disabled = true;
        resultDiv.textContent = '';
      });

      function logEvent(type) {
        db.transaction(function (tx) {
          var timestamp = new Date().toISOString();
          tx.executeSql('INSERT INTO log (type, timestamp) VALUES (?, ?)', [type, timestamp]);
        });
      }

      function calculateTotalHours() {
        db.transaction(function (tx) {
          tx.executeSql('SELECT * FROM log ORDER BY timestamp', [], function (tx, result) {
            var rows = result.rows;
            var totalHours = 0;

            for (var i = 0; i < rows.length; i += 2) {
              if (i + 1 < rows.length && rows.item(i).type === 'in' && rows.item(i + 1).type === 'out') {
                var inTime = new Date(rows.item(i).timestamp);
                var outTime = new Date(rows.item(i + 1).timestamp);

                var minutesDiff = (outTime - inTime) / (1000 * 60); // Convert milliseconds to minutes
                var hoursDiff = minutesDiff / 60; // Convert minutes to hours
                totalHours += hoursDiff;

                console.log('In: ' + inTime + ', Out: ' + outTime + ', Hours: ' + hoursDiff);
              }
            }

            resultDiv.textContent = 'Total Hours: ' + totalHours.toFixed(2);
          });
        });
      }
    });
  </script>
</head>
<body>
  <h1>Attendance Tracker</h1>
  <button id="inBtn">In</button>
  <button id="outBtn" disabled>Out</button>
  <button id="calculateBtn">Calculate</button>
  <button id="resetBtn">Reset</button>
  <div id="result"></div>
</body>
</html>
